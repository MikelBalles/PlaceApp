CREATE DATABASE PROYECTO_PLACEAPP_UNIR_2024;
USE PROYECTO_PLACEAPP_UNIR_2024;

CREATE TABLE TIPOS
(ID_TIPO INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
NOMBRE VARCHAR(45) NOT NULL,
DESCRIPCION VARCHAR(200)
);


CREATE TABLE ESPACIOS
(ID_ESPACIO INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
NOMBRE VARCHAR(50) NOT NULL,
DESCRIPCION VARCHAR(200),
FECHA_INICIO DATE,
DURACION INT,
DIRECCION VARCHAR(100),
ESTADO VARCHAR(20),
DESTACADO CHAR(1),
AFORO_MAXIMO INT,
PRECIO DEC(9,2),
ID_TIPO INT NOT NULL,
FOREIGN KEY(ID_TIPO) REFERENCES TIPOS(ID_TIPO)
);

CREATE TABLE USUARIOS
(
USERNAME VARCHAR(45) NOT NULL PRIMARY KEY,
PASSWORD VARCHAR(200) NOT NULL,
NOMBRE VARCHAR(50),
APELLIDOS VARCHAR(50),
DIRECCION VARCHAR(100),
ENABLED INT NOT NULL DEFAULT 1,
FECHA_REGISTRO DATE
);
INSERT INTO `usuarios` (`USERNAME`,`PASSWORD`,`NOMBRE`,`apellidos`,`DIRECCION`,`ENABLED`,`FECHA_REGISTRO`) VALUES ('mikel@fp.com','{noop}mikel','mikel','ballesteros','calle rosa 22, madrid',1,'2021-06-01');
INSERT INTO `usuarios` (`USERNAME`,`PASSWORD`,`NOMBRE`,`apellidos`,`DIRECCION`,`ENABLED`,`FECHA_REGISTRO`) VALUES ('alejandro@fp.com','{noop}alejandro','alejandro','paris','calle jazmin 20, madrid',1,'2021-02-01');
INSERT INTO `usuarios` (`USERNAME`,`PASSWORD`,`NOMBRE`,`apellidos`,`DIRECCION`,`ENABLED`,`FECHA_REGISTRO`) VALUES ('tomas@fp.com','{noop}tomasin','tomas','escudero','calle alamin 30, madrid',1,'2021-01-01');

CREATE TABLE RESERVAS
(ID_RESERVA INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
ID_ESPACIO INT NOT NULL,
USERNAME VARCHAR(45) NOT NULL,
PRECIO_VENTA DEC(9,2),
OBSERVACIONES VARCHAR(200),
FOREIGN KEY(USERNAME) REFERENCES USUARIOS(USERNAME),
FOREIGN KEY(ID_ESPACIO) REFERENCES ESPACIOS(ID_ESPACIO)
);

-- TABLAS PARA LOGIN, LOGOUT y REGISTRO o  SPRING SECURITY 

CREATE TABLE PERFILES
(ID_PERFIL INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
NOMBRE VARCHAR(45) NOT NULL
);
INSERT INTO `perfiles` (`ID_PERFIL`,`NOMBRE`) VALUES (1,'ROLE_ADMINISTRADOR');
INSERT INTO `perfiles` (`ID_PERFIL`,`NOMBRE`) VALUES (2,'ROLE_PROPIETARIO');
INSERT INTO `perfiles` (`ID_PERFIL`,`NOMBRE`) VALUES (3,'ROLE_CLIENTE');

CREATE TABLE USUARIO_PERFILES
(USERNAME VARCHAR(45) NOT NULL,
ID_PERFIL INT NOT NULL,
PRIMARY KEY(USERNAME, ID_PERFIL),
FOREIGN KEY(USERNAME) REFERENCES USUARIOS(USERNAME),
FOREIGN KEY(ID_PERFIL) REFERENCES PERFILES(ID_PERFIL)
);

INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('mikel@fp.com',1);
INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('alejandro@fp.com',1);
INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('mikel@fp.com',2);
INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('alejandro@fp.com',2);
INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('mikel@fp.com',3);
INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('alejandro@fp.com',3);
INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('tomas@fp.com',3);
-- creacion de usuarios para aislarlo del root

create user proyecto_unir identified by 'proyecto';
grant all privileges on PROYECTO_PLACEAPP_UNIR_2024.* to proyecto_unir;
